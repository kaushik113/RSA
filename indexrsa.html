<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSA Step-by-Step Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5em;
            font-weight: bold;
        }

        .step {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .step:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .step h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .input-group {
            margin: 15px 0;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .result {
            background: #f8f9ff;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .math-step {
            background: #fff5f5;
            border-left: 4px solid #ff6b6b;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }

        .success {
            background: #f0fff4;
            border-left: 4px solid #48bb78;
            color: #2d5a3d;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .progress-bar {
            background: #e1e5e9;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(45deg, #667eea, #764ba2);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }

        .char-encoding {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }

        .char-box {
            background: #667eea;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: monospace;
            text-align: center;
            min-width: 60px;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .warning {
            background: #fff8e1;
            border: 2px solid #ffc107;
            color: #8a6d00;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê RSA Step-by-Step Simulator</h1>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <!-- Step 1: Text Input -->
        <div class="step" id="step1">
            <h2>Step 1: Enter Your Message</h2>
            <div class="input-group">
                <label for="messageInput">Message to encrypt:</label>
                <input type="text" id="messageInput" placeholder="Hello World!">
            </div>
            <button onclick="processMessage()">Process Message</button>
            
            <div id="charEncodingResult"></div>
        </div>

        <!-- Step 2: Key Generation -->
        <div class="step" id="step2">
            <h2>Step 2: RSA Key Generation</h2>
            <div class="grid">
                <div>
                    <label for="primeP">Prime p:</label>
                    <input type="number" id="primeP" value="61" min="3" max="1000">
                </div>
                <div>
                    <label for="primeQ">Prime q:</label>
                    <input type="number" id="primeQ" value="53" min="3" max="1000">
                </div>
            </div>
            <button onclick="generateKeys()">Generate Keys</button>
            
            <div id="keyGenerationResult"></div>
        </div>

        <!-- Step 3: Block Formation -->
        <div class="step" id="step3">
            <h2>Step 3: Block Formation</h2>
            <div class="input-group">
                <label for="blockSize">Characters per block (k):</label>
                <input type="number" id="blockSize" value="2" min="1" max="4">
            </div>
            <button onclick="formBlocks()">Form Blocks</button>
            
            <div id="blockResult"></div>
        </div>

        <!-- Step 4: Encryption -->
        <div class="step" id="step4">
            <h2>Step 4: Encryption</h2>
            <button onclick="encryptMessage()">Encrypt Blocks</button>
            
            <div id="encryptionResult"></div>
        </div>

        <!-- Step 5: Decryption -->
        <div class="step" id="step5">
            <h2>Step 5: Decryption</h2>
            <button onclick="decryptMessage()">Decrypt Back to Text</button>
            
            <div id="decryptionResult"></div>
        </div>
    </div>

    <script>
        let globalState = {
            message: '',
            charCodes: [],
            p: 61,
            q: 53,
            n: 0,
            phi: 0,
            e: 17,
            d: 0,
            blocks: [],
            encryptedBlocks: [],
            blockSize: 2
        };

        function updateProgress(step) {
            const progress = (step / 5) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function isPrime(num) {
            if (num < 2) return false;
            for (let i = 2; i <= Math.sqrt(num); i++) {
                if (num % i === 0) return false;
            }
            return true;
        }

        function gcd(a, b) {
            while (b !== 0) {
                let temp = b;
                b = a % b;
                a = temp;
            }
            return a;
        }

        function modInverse(e, phi) {
            let [old_r, r] = [e, phi];
            let [old_s, s] = [1, 0];
            
            while (r !== 0) {
                let quotient = Math.floor(old_r / r);
                [old_r, r] = [r, old_r - quotient * r];
                [old_s, s] = [s, old_s - quotient * s];
            }
            
            return old_s < 0 ? old_s + phi : old_s;
        }

        function modPow(base, exp, mod) {
            let result = 1;
            base = base % mod;
            while (exp > 0) {
                if (exp % 2 === 1) {
                    result = (result * base) % mod;
                }
                exp = Math.floor(exp / 2);
                base = (base * base) % mod;
            }
            return result;
        }

        function processMessage() {
            const message = document.getElementById('messageInput').value;
            if (!message) {
                alert('Please enter a message!');
                return;
            }

            globalState.message = message;
            globalState.charCodes = [];
            
            let resultHTML = '<h3>Character Encoding (ASCII):</h3>';
            resultHTML += '<div class="char-encoding">';
            
            for (let i = 0; i < message.length; i++) {
                const char = message[i];
                const code = char.charCodeAt(0);
                globalState.charCodes.push(code);
                
                resultHTML += `<div class="char-box">'${char}' ‚Üí ${code}</div>`;
            }
            
            resultHTML += '</div>';
            resultHTML += `<div class="result">ASCII codes: [${globalState.charCodes.join(', ')}]</div>`;
            
            document.getElementById('charEncodingResult').innerHTML = resultHTML;
            updateProgress(1);
        }

        function generateKeys() {
            const p = parseInt(document.getElementById('primeP').value);
            const q = parseInt(document.getElementById('primeQ').value);
            
            if (!isPrime(p) || !isPrime(q)) {
                alert('Both p and q must be prime numbers!');
                return;
            }
            
            if (p === q) {
                alert('p and q must be different primes!');
                return;
            }
            
            globalState.p = p;
            globalState.q = q;
            globalState.n = p * q;
            globalState.phi = (p - 1) * (q - 1);
            
            // Find suitable e
            let e = 3;
            while (e < globalState.phi && gcd(e, globalState.phi) !== 1) {
                e += 2;
            }
            globalState.e = e;
            
            // Calculate d
            globalState.d = modInverse(e, globalState.phi);
            
            let resultHTML = '<div class="math-step">';
            resultHTML += `<strong>Key Generation Steps:</strong><br>`;
            resultHTML += `1. Choose primes: p = ${p}, q = ${q}<br>`;
            resultHTML += `2. Calculate n = p √ó q = ${p} √ó ${q} = ${globalState.n}<br>`;
            resultHTML += `3. Calculate œÜ(n) = (p-1)(q-1) = ${p-1} √ó ${q-1} = ${globalState.phi}<br>`;
            resultHTML += `4. Choose e = ${e} (gcd(${e}, ${globalState.phi}) = 1)<br>`;
            resultHTML += `5. Calculate d ‚â° e‚Åª¬π (mod œÜ(n)): d = ${globalState.d}<br>`;
            resultHTML += `6. Verify: e √ó d = ${e} √ó ${globalState.d} = ${e * globalState.d} ‚â° 1 (mod ${globalState.phi})<br>`;
            resultHTML += '</div>';
            
            resultHTML += `<div class="result success">`;
            resultHTML += `<strong>üîë Generated Keys:</strong><br>`;
            resultHTML += `Public Key: (n=${globalState.n}, e=${globalState.e})<br>`;
            resultHTML += `Private Key: d=${globalState.d}`;
            resultHTML += `</div>`;
            
            document.getElementById('keyGenerationResult').innerHTML = resultHTML;
            updateProgress(2);
        }

        function formBlocks() {
            if (globalState.charCodes.length === 0) {
                alert('Please process a message first!');
                return;
            }
            
            const k = parseInt(document.getElementById('blockSize').value);
            globalState.blockSize = k;
            globalState.blocks = [];
            
            let resultHTML = '<h3>Block Formation:</h3>';
            resultHTML += `<div class="math-step">Formula: M = c‚ÇÅ√ó256^(k-1) + c‚ÇÇ√ó256^(k-2) + ... + c‚Çñ√ó256‚Å∞</div>`;
            
            for (let i = 0; i < globalState.charCodes.length; i += k) {
                let blockChars = globalState.charCodes.slice(i, i + k);
                let M = 0;
                let calculation = '';
                
                for (let j = 0; j < blockChars.length; j++) {
                    const power = blockChars.length - 1 - j;
                    const term = blockChars[j] * Math.pow(256, power);
                    M += term;
                    
                    if (j > 0) calculation += ' + ';
                    calculation += `${blockChars[j]}√ó256^${power}`;
                }
                
                if (M >= globalState.n) {
                    resultHTML += `<div class="warning">‚ö†Ô∏è Block ${M} ‚â• n (${globalState.n}). Try smaller block size or different primes!</div>`;
                    return;
                }
                
                globalState.blocks.push(M);
                
                resultHTML += `<div class="result">`;
                resultHTML += `Block ${Math.floor(i/k) + 1}: [${blockChars.join(', ')}] ‚Üí ${calculation} = ${M}<br>`;
                resultHTML += `</div>`;
            }
            
            document.getElementById('blockResult').innerHTML = resultHTML;
            updateProgress(3);
        }

        function encryptMessage() {
            if (globalState.blocks.length === 0) {
                alert('Please form blocks first!');
                return;
            }
            
            globalState.encryptedBlocks = [];
            let resultHTML = '<h3>Encrypting Each Block:</h3>';
            resultHTML += `<div class="math-step">Encryption: C = M^e mod n = M^${globalState.e} mod ${globalState.n}</div>`;
            
            for (let i = 0; i < globalState.blocks.length; i++) {
                const M = globalState.blocks[i];
                const C = modPow(M, globalState.e, globalState.n);
                globalState.encryptedBlocks.push(C);
                
                resultHTML += `<div class="result">`;
                resultHTML += `Block ${i + 1}: ${M}^${globalState.e} mod ${globalState.n} = ${C}<br>`;
                resultHTML += `</div>`;
            }
            
            resultHTML += `<div class="result success">`;
            resultHTML += `<strong>üîí Encrypted Message:</strong><br>`;
            resultHTML += `[${globalState.encryptedBlocks.join(', ')}]`;
            resultHTML += `</div>`;
            
            document.getElementById('encryptionResult').innerHTML = resultHTML;
            updateProgress(4);
        }

        function decryptMessage() {
            if (globalState.encryptedBlocks.length === 0) {
                alert('Please encrypt message first!');
                return;
            }
            
            let resultHTML = '<h3>Decrypting Each Block:</h3>';
            resultHTML += `<div class="math-step">Decryption: M = C^d mod n = C^${globalState.d} mod ${globalState.n}</div>`;
            
            let decryptedMessage = '';
            
            for (let i = 0; i < globalState.encryptedBlocks.length; i++) {
                const C = globalState.encryptedBlocks[i];
                const M = modPow(C, globalState.d, globalState.n);
                
                resultHTML += `<div class="result">`;
                resultHTML += `Block ${i + 1}: ${C}^${globalState.d} mod ${globalState.n} = ${M}<br>`;
                
                // Convert back to characters
                let chars = [];
                let temp = M;
                const k = globalState.blockSize;
                
                for (let j = 0; j < k && temp > 0; j++) {
                    const charCode = temp % 256;
                    if (charCode > 0) {
                        chars.unshift(String.fromCharCode(charCode));
                    }
                    temp = Math.floor(temp / 256);
                }
                
                const blockText = chars.join('');
                decryptedMessage += blockText;
                resultHTML += `Converting: ${M} ‚Üí "${blockText}"<br>`;
                resultHTML += `</div>`;
            }
            
            const success = decryptedMessage === globalState.message;
            resultHTML += `<div class="result ${success ? 'success' : 'warning'}">`;
            resultHTML += `<strong>üîì Decrypted Message:</strong><br>`;
            resultHTML += `"${decryptedMessage}"<br>`;
            resultHTML += `<strong>Original Message:</strong><br>`;
            resultHTML += `"${globalState.message}"<br>`;
            resultHTML += `<strong>Match:</strong> ${success ? '‚úÖ SUCCESS!' : '‚ùå FAILED'}`;
            resultHTML += `</div>`;
            
            document.getElementById('decryptionResult').innerHTML = resultHTML;
            updateProgress(5);
        }

        // Initialize with default values
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('messageInput').value = 'Hi!';
        });
    </script>
</body>
</html>